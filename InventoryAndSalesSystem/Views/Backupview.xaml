<UserControl x:Class="InventoryAndSalesSystem.Views.BackupView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,20">
                <TextBlock Text="Auto Backup" FontSize="22" FontWeight="Bold" Margin="0,0,0,5"/>
                <TextBlock Text="Data is automatically backed up every 7 days. You can also run a manual backup anytime."
                           FontSize="12" Foreground="Gray"/>
            </StackPanel>

            <!-- Info Cards -->
            <Grid Grid.Row="1" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="15"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="15"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Background="#1976D2" CornerRadius="8" Padding="20">
                    <StackPanel>
                        <TextBlock Text="🕐 Last Backup" Foreground="White" FontSize="13" Margin="0,0,0,8"/>
                        <TextBlock Text="{Binding LastBackupDisplay}" Foreground="White"
                                   FontSize="15" FontWeight="Bold" TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="2" Background="#388E3C" CornerRadius="8" Padding="20">
                    <StackPanel>
                        <TextBlock Text="📅 Next Scheduled Backup" Foreground="White" FontSize="13" Margin="0,0,0,8"/>
                        <TextBlock Text="{Binding NextBackupDisplay}" Foreground="White"
                                   FontSize="15" FontWeight="Bold" TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="4" Background="#7B1FA2" CornerRadius="8" Padding="20">
                    <StackPanel>
                        <TextBlock Text="🗃️ Stored Backups" Foreground="White" FontSize="13" Margin="0,0,0,8"/>
                        <TextBlock Foreground="White" FontSize="24" FontWeight="Bold">
                            <Run Text="{Binding TotalBackups, Mode=OneWay}"/>
                            <Run Text=" / 8" FontSize="14"/>
                        </TextBlock>
                        <TextBlock Text="(oldest auto-removed)" Foreground="White" FontSize="10" Margin="0,3,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Action Buttons + Status -->
            <Border Grid.Row="2" Background="White" BorderBrush="#E0E0E0"
                    BorderThickness="1" CornerRadius="8" Padding="20" Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Manual Backup" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                    <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="Gray" Margin="0,0,0,15">
                        Running a manual backup saves a zip of all Excel data files (Products.xlsx, Sales.xlsx, StockLogs.xlsx)
                        to the Backups folder. The 8 most recent backups are kept automatically.
                    </TextBlock>

                    <StackPanel Orientation="Horizontal">
                        <Button Content="💾 Backup Now"
                                Command="{Binding BackupNowCommand}"
                                Style="{StaticResource PrimaryButton}"
                                Width="160" Height="42" FontSize="14"/>
                        <Button Content="📂 Open Backup Folder"
                                Command="{Binding OpenFolderCommand}"
                                Style="{StaticResource SecondaryButton}"
                                Width="180" Height="42" FontSize="14"/>
                        <Button Content="🔄 Refresh"
                                Command="{Binding RefreshCommand}"
                                Background="#757575" Foreground="White"
                                Padding="15,8" Margin="5" Cursor="Hand"
                                FontWeight="SemiBold" BorderThickness="0"
                                Height="42"/>
                    </StackPanel>

                    <!-- Status Message -->
                    <TextBlock Text="{Binding StatusMessage}"
                               FontSize="13" FontWeight="SemiBold" Margin="5,12,0,0"
                               Visibility="{Binding StatusMessage, Converter={StaticResource NullToVisibilityConverter}}"/>
                </StackPanel>
            </Border>

            <!-- Backup History Table -->
            <Border Grid.Row="3" Background="White" BorderBrush="#E0E0E0"
                    BorderThickness="1" CornerRadius="8" Padding="20">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Backup History"
                               FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                    <DataGrid ItemsSource="{Binding BackupFiles}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              AlternatingRowBackground="#F5F5F5"
                              IsReadOnly="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="File Name" Binding="{Binding FileName}" Width="*"/>
                            <DataGridTextColumn Header="Created" Binding="{Binding CreatedDisplay}" Width="180"/>
                            <DataGridTextColumn Header="Size" Binding="{Binding SizeDisplay}" Width="100"/>
                            <DataGridTextColumn Header="Full Path" Binding="{Binding FilePath}" Width="300"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </Border>
        </Grid>
    </ScrollViewer>
</UserControl>
